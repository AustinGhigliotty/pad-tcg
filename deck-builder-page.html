<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Deck Builder - PAD Card Game</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="deck-builder-page-styling.css">
</head>
<body>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script>
    var cardList;
    $.getJSON("./cardList", getCardList);

    function getCardList(data) {
        cardList = data;
    }

    var myDecks;
    $.getJSON("./myDecks", getSavedDecks);

    function getSavedDecks(data) {
        myDecks = data;
    }
    alert("Game is starting!");
</script>
<script src="deck-builder.js"></script>
<script>
	var buildingDeck = [];
</script>

<label for="card-search">Search:</label>
<input type="text" id="card-search" onkeyup="cardSearch()">
<div class="card-search-container">
	<div class="card-search-list row">

	</div>
</div>

<div class="deck-row-container">
	<div class="row deck-list">

	</div>
</div>

<br>

<label for="deck-name">Deck Name: </label>
<input type="text" id="deck-name">

<button id="build-deck-finish" onclick="createDeck()">Finish</button>
<span class="card-count"></span>

<script>
    $('.card-count').text(buildingDeck.length + ' cards');

	$('html').append('<div class="container shown-cards">');
        $('.shown-cards').append('<div class="row shown-cards-row">');
	// for (let i = 0; i < 6; i++) {
        // $('.shown-cards').append('<div class="row row' + i + '">');
        // for (let j = 0; j < 10; j++) {
            // $('.shown-cards-row').append('<div class="shown-card shown-card' + (j + (i*10)) + '"></div>');
	// 	}
	// }
        $('.shown-cards').append('</div>');
    $('html').append('</div>');
	$('.shown-card').css('width', ($('.shown-cards').css('width')/10));

</script>

<script>
	function cardSearch() {
        let totalCardWidth = 0;
        let input = $('#card-search').val().toUpperCase();
		$('.card-search-list').empty();
        for (let i = 0; i < Object.keys(cardList).length; i++) {
            if (Object.values(cardList)[i].name.toUpperCase().indexOf(input) > -1) {
            	$('.card-search-list').append('<div class="col searched-card searched-card' + i + ' ' + Object.keys(cardList)[i] + '"><img src="cards/' + Object.keys(cardList)[i] + '.jpg"><p>' + Object.values(cardList)[i].name + '</p></div>');
				totalCardWidth++;
            }
		}
	    $('.card-search-list').width(totalCardWidth * 245);
    }

    $(document).on('click', '.searched-card', function () {
        buildingDeck.push($(this).attr('class').split(' ')[3]);
        updateShownCards();
        $('.card-count').text(buildingDeck.length + ' cards');
    });

    $(document).on('click', '.shown-card', function () {
        // buildingDeck.push($(this).attr('class').split(' ')[3]);
        buildingDeck.splice($(this).attr('class').split(' ')[1].split('shown-card')[1], 1);
        $('.shown-card' + buildingDeck.length).empty();
        updateShownCards();
        $('.card-count').text(buildingDeck.length + ' cards');
    });

	function updateShownCards() {
	    for (let i = 0; i < buildingDeck.length; i++) {
	        if (i < $('.shown-cards-row').children().length) {
	        	$('.shown-card' + i).empty();
			} else {
                $('.shown-cards-row').append('<div class="shown-card shown-card' + i + '"></div>');
			}
            $('.shown-card' + i).append('<img src="cards/' + buildingDeck[i] + '.jpg">');
		}
    }

	function createDeck() {
		var deckName = $('#deck-name').val();
		var createdDeck = {};
		createdDeck[deckName] = buildingDeck;
		createdDeck = JSON.stringify(createdDeck);
		createdDeck = btoa(createdDeck);
		localStorage.setItem('_createdDeck' + deckName, createdDeck);

        window.location = 'deck-builder.html';
    }

</script>
</body>
</html>